<%= link_to "Volver", resources_path %> 
<% if current_user.admin? %>
  | <%= link_to "Crear reserva", new_resource_booking_path(:resource_id => params[:resource_id])%>
<% end %> 
<%if @bookings.present? %>
  <p>Lista de reservas</p>
  <table width="100%">
    <tr>
      <td>Inicio</td>
      <td>Fin</td>
      <td>Estado </td>
      <td>Usuario </td> 
   </tr>
    <%@bookings.each do |b|%>
    <tr>
      <td><%=Time.parse(b[:start]).strftime('%F %R')%></td>
      <td><%=Time.parse(b[:finish]).strftime('%F %R')%></td>
      <td><%=b[:status]||='free'%></td>
      <td><%=b[:user_name]%></td>
      <td>
        <% case b[:status] %>
        <% when 'approved' %> 
           <% if (current_user.admin? or current_user.id == b[:user].to_i) %>
             <%= link_to "Cancelar", resource_booking_path(:id => b[:id], :resource_id => params[:resource_id]), :method => :delete %>
           <% end %>
        <% when 'pending' %>  
           <% if current_user.admin? %>
             <%= link_to "Aprobar", resource_booking_path(:id => b[:id], :resource_id => params[:resource_id]), :method => :put  %> |
           <% end %>
          <% if (current_user.admin? || current_user[:id] == b[:user].to_i) %>
               <%= link_to "Rechazar", resource_booking_path(:id => b[:id], :resource_id => params[:resource_id]), :method => :delete  %>
           <% end %> 

        <% when 'free' %>     
           <%= link_to "Reservar", new_resource_booking_path(:resource_id => params[:resource_id], :start => b[:start], :finish => b[:finish], :user_name => current_user[:full_name], :user_id => current_user[:id]) %>
        <% end %>
      </td>
    </tr>
    </tr>
    <%end%>
  </table>
<%else%>
  <p>No Bookings Found</p>
<%end%>